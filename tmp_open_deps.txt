    def _open_deps_wizard(self):
        """æ‰“å¼€ä¾èµ–ç®¡ç†å‘å¯¼"""
        from deps_bootstrap import ensure_deps, needs_restart_for_install
        from qfluentwidgets import InfoBar, InfoBarPosition, MessageBox
        # æ£€æµ‹æ˜¯å¦æœ‰å†²çªæ¨¡å—å·²åŠ è½½
        need_restart, loaded_mods = needs_restart_for_install()
        if need_restart:
            # æœ‰æ¨¡å—å·²åŠ è½½ï¼Œæç¤ºç”¨æˆ·é‡å¯
            mod_list = ", ".join(loaded_mods[:5])
            if len(loaded_mods) > 5:
                mod_list += f" ç­‰ {len(loaded_mods)} ä¸ªæ¨¡å—"
            msg = MessageBox(
                "æ£€æµ‹åˆ°æ¨¡å—å†²çª",
                f"â€¢ ä»¥ä¸‹æ¨¡å—å·²è¢«ç¨‹åºåŠ è½½:{mod_list}\n"
                "â€¢ è¿™å¯èƒ½å¯¼è‡´ä¾èµ–å®‰è£…å¤±è´¥(æ–‡ä»¶è¢«å ç”¨)\n"
                "â€¢ å»ºè®®é‡å¯ç¨‹åºå¹¶ç›´æ¥æ‰“å¼€å‘å¯¼ã€‚æ˜¯å¦ç«‹å³é‡å¯ï¼Ÿ\n"
                "â€¢ ESCå–æ¶ˆæ“ä½œ",
                self
            )
            msg.yesButton.setText("é‡å¯ç¨‹åº")
            msg.cancelButton.setText("ç»§ç»­å®‰è£…")
            # ESC é”®æ£€æµ‹ï¼šç”¨æˆ·æŒ‰ ESC ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
            esc_pressed = [False]
            from PyQt6.QtCore import Qt as QtCore_Qt
            from PyQt6.QtGui import QKeyEvent
            original_keyPressEvent = msg.keyPressEvent
            def custom_keyPressEvent(event: QKeyEvent):
                if event.key() == QtCore_Qt.Key.Key_Escape:
                    esc_pressed[0] = True
                    msg.close()
                else:
                    original_keyPressEvent(event)
            msg.keyPressEvent = custom_keyPressEvent
            result = msg.exec()
            # å¦‚æœç”¨æˆ·æŒ‰ ESCï¼Œç›´æ¥è¿”å›ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
            if esc_pressed[0]:
                return
            if result:
                # ç”¨æˆ·é€‰æ‹©é‡å¯
                self._restart_with_wizard()
                return
            # ç”¨æˆ·é€‰æ‹©ç»§ç»­ï¼Œæ˜¾ç¤ºè­¦å‘Š
            InfoBar.warning(
                title="æ³¨æ„",
                content="å¦‚é‡å®‰è£…å¤±è´¥ï¼Œè¯·å…³é—­ç¨‹åºåæ‰‹åŠ¨å®‰è£…",
                parent=self.parent() if self.parent() else None,
                duration=5000,
                position=InfoBarPosition.TOP
            )
        # å…³é—­å½“å‰è®¾ç½®çª—å£
        self.close()
        # å¼ºåˆ¶æ˜¾ç¤ºå‘å¯¼ç•Œé¢ï¼ˆalways_show_ui=True, from_settings=Trueï¼‰
        try:
            ok = ensure_deps(prompt_ui=True, always_show_ui=True, from_settings=True)
            if ok:
                InfoBar.success(
                    title="æç¤º",
                    content="ä¾èµ–å®‰è£…å®Œæˆï¼Œéƒ¨åˆ†æ›´æ”¹å¯èƒ½éœ€è¦é‡å¯ç¨‹åºç”Ÿæ•ˆã€‚",
                    parent=self.parent() if self.parent() else None,
                    duration=5000,
                    position=InfoBarPosition.TOP
                )
        except Exception as e:
            InfoBar.error(
                title="é”™è¯¯",
                content=f"ä¾èµ–å‘å¯¼å‡ºé”™: {e}",
                parent=self.parent() if self.parent() else None,
                duration=5000,
                position=InfoBarPosition.TOP
            )
    def _restart_with_wizard(self):
        """é‡å¯ç¨‹åºå¹¶æ‰“å¼€ä¾èµ–å‘å¯¼"""
        import subprocess
        import sys
        import os
        # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè®©æ–°è¿›ç¨‹çŸ¥é“è¦æ‰“å¼€å‘å¯¼
        env = os.environ.copy()
        env["LATEXSNIPPER_OPEN_WIZARD"] = "1"
        env["LATEXSNIPPER_FORCE_VERIFY"] = "1"
        env["LATEXSNIPPER_RESTART"] = "1"
        # è·å–å½“å‰ Python å’Œè„šæœ¬è·¯å¾„
        python_exe = sys.executable
        script_path = os.path.abspath(sys.argv[0])
        try:
            # å¯åŠ¨æ–°è¿›ç¨‹
            if script_path.endswith('.py'):
                subprocess.Popen(
                    [python_exe, script_path, "--force-deps-check"],
                    env=env,
                    creationflags=subprocess.CREATE_NEW_PROCESS_GROUP
                )
            else:
                # æ‰“åŒ…åçš„ exe
                subprocess.Popen(
                    [script_path, "--force-deps-check"],
                    env=env,
                    creationflags=subprocess.CREATE_NEW_PROCESS_GROUP
                )
            # å…³é—­å½“å‰ç¨‹åº
            from PyQt6.QtWidgets import QApplication
            QApplication.instance().quit()
        except Exception as e:
            from qfluentwidgets import InfoBar, InfoBarPosition
            InfoBar.error(
                title="é‡å¯å¤±è´¥",
                content=f"æ— æ³•é‡å¯ç¨‹åº: {e}",
                parent=self,
                duration=5000,
                position=InfoBarPosition.TOP
            )
    def _show_info(self, title: str, content: str, level: str = "info"):
        """æ˜¾ç¤º Fluent æµ®åŠ¨æç¤º"""
        from qfluentwidgets import InfoBar, InfoBarPosition
        # å§‹ç»ˆæµ®åœ¨è®¾ç½®çª—å£ï¼Œé¿å…é®æŒ¡ä¸»çª—å£
        parent = self
        func = getattr(InfoBar, level, InfoBar.info)
        func(
            title=title,
            content=content,
            parent=parent,
            duration=4000,
            position=InfoBarPosition.TOP
        )
    def select_model(self, model_name: str):
        # åªå‘å°„ä¿¡å·ï¼Œç”±ä¿¡å·è¿æ¥çš„ on_model_changed å¤„ç†
        self.model_changed.emit(model_name)
        self.update_model_selection()
        self._update_compute_mode_label()
    def _update_compute_mode_label(self):
        """æ›´æ–°è®¡ç®—æ¨¡å¼çŠ¶æ€æ ‡ç­¾"""
        try:
            import torch
            cuda_available = torch.cuda.is_available()
            if cuda_available:
                gpu_name = torch.cuda.get_device_name(0)
                self.lbl_compute_mode.setText(f"ğŸŸ¢ GPU å¯ç”¨: {gpu_name}")
                self.lbl_compute_mode.setStyleSheet("color: #2e7d32; font-size: 11px; padding: 4px;")
            else:
                self.lbl_compute_mode.setText("ğŸŸ¡ ä»… CPU æ¨¡å¼ (æœªæ£€æµ‹åˆ° GPUå±‚ä¾èµ–)")
                self.lbl_compute_mode.setStyleSheet("color: #f57c00; font-size: 11px; padding: 4px;")
        except Exception:
            self.lbl_compute_mode.setText("âšª è®¡ç®—æ¨¡å¼æœªçŸ¥")
            self.lbl_compute_mode.setStyleSheet("color: #666; font-size: 11px; padding: 4px;")
    def update_model_selection(self):
        # sync model combo selection state
        current = None
        desired = None
        if self.parent() and hasattr(self.parent(), "desired_model"):
            desired = self.parent().desired_model
        elif self.parent() and hasattr(self.parent(), "cfg"):
            desired = self.parent().cfg.get("desired_model", None)
        if self.parent() and hasattr(self.parent(), "current_model"):
            current = self.parent().current_model
        target = desired or current
        if target and str(target).startswith("pix2text"):
            target_key = "pix2text"
        else:
            target_key = target
        if target_key:
            for i, (key, _) in enumerate(self._model_options):